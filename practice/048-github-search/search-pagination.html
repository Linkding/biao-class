<style>
    * {
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
    }

    /* [hidden] {
            display: none !important;
        } */

    body {
        font-size: 17px;
        font-family: sans-serif;
    }

    img {
        max-width: 50px;
    }

    a {
        text-decoration: none;
        cursor: pointer;
    }

    .container {
        width: 500px;
        margin: 0 auto;
    }


    h1 {
        margin-top: 100px;
    }

    #form-search,
    h1 {
        vertical-align: middle;
        text-align: center;
    }

    .user {
        background: rgba(0%, 0%, 0%, .01);
        margin: 8px 0;
        box-shadow: 1px 1px 1px #757575;
        /* border: 1px solid #999; */
    }

    .user>* {
        vertical-align: top;
        display: inline-block;
    }

    .logo {
        padding: 5px;
    }

    .info {
        line-height: 1.3;
        padding: 5px 0;
    }

    .name {
        font-size: 1.2rem;
        font-weight: 900;
    }

    .link {
        font-size: 0.4rem;
        font-weight: 200;
    }

    form {
        font-size: 0;

    }

    form input {
        width: 80%;
    }


    form button {
        width: 20%;
        border-left: 0;
    }

    input,
    button {
        border: 1px solid rgba(0%, 0%, 0%, .4);
        padding: 10px;
        font-size: 1rem;
        color: #555;
    }

    .count {
        margin-top: 20px
    }

    #load-more {
        display: none;
        width: 100%;
    }

    #load-more:hover {
        background: rgba(0%, 0%, 0%, .1)
    }

    #load-more[hidden] {
        display: inline-block;
    }

    .page {
        text-align: center;
    }

    .pagination-container {
        text-align: center;
        font-size: 1rem;
    }

    .pagination-container >* {
        display: inline-block;
        margin-top: 15px;
    }
</style>
<div class="container">
    <h1>Github用户搜索</h1>
    <form id="form-search" autocomplete="off">
        <input type="text" id="search-input" placeholder="请输入">
        <button type="submit">搜一下</button>
    </form>
    <div id="count"></div>
    <div id="user-list">
        <!-- <div class="user">
                <div class="logo">
                    <img src="https://avatars0.githubusercontent.com/u/2541208?v=4">
                </div>
                <div class="info">
                    <div class="name">link</div>
                    <a href="http://linkding.github.com" class="link">http://linkding.github.com</a>
                </div>
            </div>
            <div class="user">
                <div class="logo">
                    <img src="https://avatars0.githubusercontent.com/u/2541208?v=4">
                </div>
                <div class="info">
                    <div class="name">link</div>
                    <a href="http://linkding.github.com" class="link">http://linkding.github.com</a>
                </div>
            </div> -->
    </div>
    <!-- <button type="submit" id="load-more" hidden>加载更多</button> -->
    <div class="pagination-container" hidden>
        <button id="first-page" class="pager">首页</button>
        <div class="pagination">
        </div>
        <button id="last-page" class="pager">尾页</button>
    </div>
</div>

<script>
    ; (function () {
        'use strict';

        var input = document.querySelector('#search-input')
            , form_search = document.querySelector('#form-search')
            , el_user_list = document.querySelector('#user-list')
            , el_pagination = document.querySelector('.pagination')
            , el_pagination_container = document.querySelector('.pagination-container')
            , res //获取回来的数据
            , keyword
            , amount
            , current_page = 1
            , limit = 5
            , max_btn_length = 5
            , current_page = 1
            , page_amount

        //入口函数
        init();


        function init() {
            detect_user_list();
        }

        //绑定表单提交事件
        function detect_user_list() {
            form_search.addEventListener('submit', function (e) {
                e.preventDefault();
                keyword = input.value
                search();
            })
        }
        function search() {
            //准备发射
            var http = new XMLHttpRequest();
            http.open('get', 'https://api.github.com/search/users?q=' + keyword + '&page=' + current_page + '&per_page=' + limit)
            http.setRequestHeader('Authorization', 'Basic ' + btoa('biaoyansu:94bfe1cf32b7aa3d0c2cbdd94958510841afece0'));

            //发射
            http.send()

            http.addEventListener('load', function () {
                //解析返回的数据 将Json格式的字符串，转换为JSON数据
                res = JSON.parse(http.responseText);
                
                //拿到搜索结果总数据
                amount = res.total_count
                //有了数据，开始渲染用户列表&页码
                render_user();
                render_pagination();
            })
        }
        //渲染 用户数据
        function render_user() {
            var html = ``

            res.items.forEach(function (user) {
                html = html + `
                <div class="user">
                <div class="logo">
                    <img src="${user.avatar_url}">
                </div>
                <div class="info">
                    <div class="name">${user.login}</div>
                    <a href="${user.html_url}" class="link">${user.html_url}</a>
                </div>
                </div>
                `
            });
            // 将模板导入页面渲染位置
            el_user_list.innerHTML = html;

            //渲染搜索结果
            document.querySelector('#count').innerHTML = `共有${res.total_count}条结果`


        }
        
        //计算总共多少页
        function get_page_amount (){
            page_amount = Math.floor( amount / limit);
        }
        function clear_pagination(){
            el_pagination.innerHTML = ''
        }
        
        function hidden_pagination(){
            el_pagination_container.hidden = true;
        }

        function show_pagination(){
            el_pagination_container.hidden = false;
        }
        function render_pagination() {
            show_pagination();
            clear_pagination();
            get_page_amount();

            var start
                , end
                , middle = Math.ceil(max_btn_length / 2)
                , reaching_left = current_page <= middle
                , reaching_right = current_page >= page_amount - middle
            
            //三分法，区分三个情况下，max_btn_length数内，第一和最后一个按钮数字
            if (reaching_left) {
                start = 1
                end = max_btn_length
            } else if (reaching_right) {
                start = page_amount - max_btn_length
                end = page_amount
            } else {
                start = current_page - (middle - 1)
                end = current_page + (middle - 1)
            }

            console.log('test1')
            for (var i = start; i <= end; i++) {
                var num = i;
                
                var btn = document.createElement('button');
                btn.innerText = num;
                btn.dataset.page = num;
                
                //为当前页码着色
                if(current_page == num)
                    btn.style.background = 'pink'

                //追加到指定页码位置
                el_pagination.appendChild(btn);
                console.log('test2')
                btn.addEventListener('click',make_funcation_on_page_change(num))
            };
        }

        function make_funcation_on_page_change(num){
            return function(e){
                current_page = num;
                search();
            }
        }
    })();
</script>